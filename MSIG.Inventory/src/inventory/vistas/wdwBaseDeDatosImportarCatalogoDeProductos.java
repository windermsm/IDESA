/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package inventory.vistas;

import inventory.acceso.AccesoExcepciones;
import inventory.acceso.AccesoProducto;
import inventory.objetos.ObjetosProducto;
import inventory.servicios.ServicioLeerArchivoExcel;
import java.io.File;
import java.util.ArrayList;
import java.util.Iterator;
import javax.swing.JFileChooser;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Megabyte Soluciones Integrales Guatemala
 */
public class wdwBaseDeDatosImportarCatalogoDeProductos extends javax.swing.JInternalFrame {

    /**
     * Creates new form wdwBaseDeDatosImportarCatalogoDeProductos
     */
    public wdwBaseDeDatosImportarCatalogoDeProductos() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        tblDatosExcel = new javax.swing.JTable();
        btnSeleccionarArchivo = new javax.swing.JButton();
        btnGuardar = new javax.swing.JButton();

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("Importar Catalogo de Productos");
        setFrameIcon(new javax.swing.ImageIcon(getClass().getResource("/inventory/imagenes/imgBaseDeDatosImportar.png"))); // NOI18N

        tblDatosExcel.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "ID Producto", "Marca", "Descripcion", "Linea", "Precio Compra", "Precio Estandar", "ID Proveedor", "Existencia", "Unidad de Medida", "Minimo", "Maximo", "% Estandar", "% Minimo", "Precio Minimo", "Codigo Fabricante", "Ubicacion", "Factura", "Descuento", "Visible", "Serie", "Componente", "Garantia"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false, false, false, false, false, false, false, true, true, true, true, true, true, true, true, true
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(tblDatosExcel);
        tblDatosExcel.getColumnModel().getColumn(6).setResizable(false);
        tblDatosExcel.getColumnModel().getColumn(9).setResizable(false);

        btnSeleccionarArchivo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/inventory/imagenes/imgBotonArchivoCSV.png"))); // NOI18N
        btnSeleccionarArchivo.setText("Archivo");
        btnSeleccionarArchivo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSeleccionarArchivoActionPerformed(evt);
            }
        });

        btnGuardar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/inventory/imagenes/imgBotonGuardar.png"))); // NOI18N
        btnGuardar.setText("Guardar");
        btnGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGuardarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 864, Short.MAX_VALUE)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(btnGuardar)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnSeleccionarArchivo)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 344, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnSeleccionarArchivo)
                    .addComponent(btnGuardar))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    private void btnSeleccionarArchivoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSeleccionarArchivoActionPerformed
       
        DefaultTableModel tabla_productos = null;
        ArrayList lista_productos = new ArrayList();
        AccesoExcepciones Mensaje = new AccesoExcepciones();

        JFileChooser flcArchivo = new JFileChooser(".");
        int estado = flcArchivo.showOpenDialog(null);

        if (estado == JFileChooser.APPROVE_OPTION) {

            File archivo_seleccionado = flcArchivo.getSelectedFile();
            ServicioLeerArchivoExcel LeerArchivoExcel = new ServicioLeerArchivoExcel();
            String direccion = archivo_seleccionado.getParent()+"\\"+archivo_seleccionado.getName();
            
            lista_productos = LeerArchivoExcel.leer_archivo_excel(direccion);
            Iterator reiterador = lista_productos.iterator();
            
            try{
                
                Object datos[] = new Object [22];
                tabla_productos = (DefaultTableModel) tblDatosExcel.getModel();
                
                /*for (int i = tblDatosExcel.getRowCount() - 1; i>=0; i--){
                    tabla_productos.removeRow(i);
                }*/
                
                while(reiterador.hasNext()){
                    ObjetosProducto Producto;
                    Producto = (ObjetosProducto) reiterador.next();
                    datos[0] = Producto.getId_producto();
                    datos[1] = Producto.getMarca_producto();
                    datos[2] = Producto.getDesc_producto();
                    datos[3] = Producto.getLinea_producto();
                    datos[4] = Producto.getPrecio_compra_producto();
                    datos[5] = Producto.getPrecio_est_producto();
                    datos[6] = Producto.getId_proveedor();
                    datos[7] = Producto.getExi_producto();
                    datos[8]= Producto.getUnidad_medida_producto();
                    datos[9]= Producto.getMaximo_producto();
                    datos[10]= Producto.getMinimo_producto();
                    datos[11] = Producto.getPrj_est_producto();
                    datos[12] = Producto.getPrj_min_producto();
                    datos[13] = Producto.getPrecio_min_producto();
                    datos[14] = Producto.getCodigo_fabricante();
                    datos[15] = Producto.getUbicacion_producto();
                    datos[16] = Producto.getFactura_producto();
                    datos[17] = Producto.getDescuento_producto();
                    datos[18] = Producto.getVisible_producto();
                    datos[19] = Producto.getSerie_producto();
                    datos[20] = Producto.getComponente_producto();
                    datos[21] = Producto.getGarantia_producto();
                    tabla_productos.addRow(datos);
                }
                
            } catch(Exception e){

            }

        } else if (estado == JFileChooser.CANCEL_OPTION) {
            
        }
        
        tblDatosExcel.setModel(tabla_productos);
        
    }//GEN-LAST:event_btnSeleccionarArchivoActionPerformed

    private void btnGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnGuardarActionPerformed
        
        ObjetosProducto Producto = new ObjetosProducto();
        AccesoProducto NuevoProducto = new AccesoProducto();
        AccesoExcepciones Mensaje = new AccesoExcepciones();

        //ALMACENAR LA INFORMACION DE CADA PRODUCTO EN LA BASE DE DATOS
        try {
            for (int cFila = 0; cFila < tblDatosExcel.getRowCount(); cFila++) {
                Producto.setId_producto(tblDatosExcel.getValueAt(cFila, 0).toString());
                Producto.setMarca_producto(tblDatosExcel.getValueAt(cFila, 1).toString());
                Producto.setDesc_producto(tblDatosExcel.getValueAt(cFila, 2).toString());
                Producto.setLinea_producto(tblDatosExcel.getValueAt(cFila, 3).toString());
                Producto.setPrecio_compra_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 4).toString()));
                Producto.setPrecio_est_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 5).toString()));
                Producto.setId_proveedor(Integer.parseInt(tblDatosExcel.getValueAt(cFila, 6).toString()));
                Producto.setExi_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 7).toString()));
                Producto.setUnidad_medida_producto(tblDatosExcel.getValueAt(cFila, 8).toString());
                Producto.setMaximo_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 9).toString()));
                Producto.setMinimo_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 10).toString()));
                Producto.setPrj_est_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 11).toString()));
                Producto.setPrj_min_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 12).toString()));
                Producto.setPrecio_min_producto(Float.parseFloat(tblDatosExcel.getValueAt(cFila, 13).toString()));
                Producto.setCodigo_fabricante(tblDatosExcel.getValueAt(cFila, 14).toString());
                Producto.setUbicacion_producto(tblDatosExcel.getValueAt(cFila, 15).toString());
                Producto.setFactura_producto(tblDatosExcel.getValueAt(cFila, 16).toString());
                Producto.setDescuento_producto(tblDatosExcel.getValueAt(cFila, 17).toString());
                Producto.setVisible_producto(tblDatosExcel.getValueAt(cFila, 18).toString());
                Producto.setSerie_producto(tblDatosExcel.getValueAt(cFila, 19).toString());
                Producto.setComponente_producto(tblDatosExcel.getValueAt(cFila, 20).toString());
                Producto.setGarantia_producto(tblDatosExcel.getValueAt(cFila, 21).toString());
                
                try {
                    NuevoProducto.actualizarProducto(Producto, Inventory.lblUsuario.getText(), Inventory.lblTerminal.getText());
                } catch (Exception error) {
                    Mensaje.manipulacionExcepciones("critico", error.getMessage(), "Actualizar Proucto " + Producto.getId_producto());
                }
            } 
            
            Mensaje.manipulacionExcepciones("informacion", "La Base de Datos fue Actualizada con Exito.", "Boton Guardar");
        }catch(Exception error){
            Mensaje.manipulacionExcepciones("critico", error.getMessage(), "Boton Guardar");
        }
    }//GEN-LAST:event_btnGuardarActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnGuardar;
    private javax.swing.JButton btnSeleccionarArchivo;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable tblDatosExcel;
    // End of variables declaration//GEN-END:variables
}